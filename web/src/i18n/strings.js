export const LOCALES = {
    EN: 'en',
    ZH: 'zh',
};

export const DEFAULT_LOCALE = LOCALES.EN;

export const STORAGE_KEY = 'ghostlink-locale';

const STRINGS = {
    en: {
        common: {
            appName: 'GHOSTLINK',
            language: 'Language',
            english: 'English',
            chinese: '中文',
            close: 'Close',
            or: 'OR',
            verified: 'Verified',
            connect: 'Connect',
            generatingProof: 'Generating proof...',
            source: 'SOURCE',
            zkCircuit: 'ZK CIRCUIT',
            kilobytes: 'KB',
        },
        theme: {
            toggle: 'Toggle theme',
            switchToLight: 'Switch to light mode',
            switchToDark: 'Switch to dark mode',
            lightMode: 'Light mode',
            darkMode: 'Dark mode',
        },
        nav: {
            home: 'Home',
            solutions: 'Solutions',
            explorer: 'Explorer',
            developers: 'Developers',
            company: 'Company',
        },
        wallet: {
            connect: 'Connect Wallet',
            connecting: 'Connecting...',
            disconnect: 'Disconnect',
            disconnected: 'Wallet disconnected',
            notConnected: 'Wallet not connected. Please connect wallet first.',
        },
        portfolio: {
            onChainAssets: 'On-Chain Assets',
            readyToVerify: 'Ready to Verify',
            connectToVerify: 'Connect wallet to verify',
            verify: 'Verify',
            verifying: 'Verifying...',
            mint: 'Mint Credential',
            verificationFailed: 'Verification failed',
            walletNotConnected: 'Wallet not connected',
            progressTitle: 'Wallet · Proof → Mint',
            verified: 'VERIFIED',
            minted: 'MINTED',
            transactionHistory: 'Transaction History',
            signing: 'Signing...',
            retry: 'Retry',
            generatingProof: 'Generating proof...',
            txCount: '{count} TX',
        },
        modal: {
            processing: 'Processing',
            zkGenerating: 'ZK proof is generating...',
            mintSuccess: 'Mint succeeded',
            viewOnEtherscan: 'View on Etherscan →',
            errorPrefix: 'Error::',
        },
        progress: {
            stepGenerate: 'Generate ZK Proof',
            stepPrepare: 'Prepare Transaction',
            stepConfirm: 'Confirm in Wallet',
            stepAwait: 'Await Confirmation',
            stepDone: 'Completed',
            descGenerate: 'Prover is starting…',
            descPrepare: 'Transaction is preparing…',
            descConfirm: 'Waiting wallet confirmation…',
            descAwait: 'Waiting for chain confirmation…',
            descDone: 'Done',
            proofReady: 'Proof ready',
            txParamsReady: 'Transaction parameters ready',
            confirmInWallet: 'Please confirm in your wallet',
            waitingWallet: 'Waiting for wallet confirmation...',
            txSubmittedWaiting: 'Transaction submitted, waiting for confirmation...',
            txSubmitted: 'Transaction submitted...',
            mintedOk: 'Credential minted successfully.',
            failedPrefix: 'Failed: {message}',
            proofToMint: 'Proof → Mint',
            githubProofToMint: 'GitHub · Proof → Mint',
            twitterProofToMint: 'X · Proof → Mint',
        },
        footer: {
            tagline: 'Turn Web2 data into verifiable on-chain credentials with zero-knowledge proofs.',
            resources: 'Resources',
            company: 'Company',
            documentation: 'Documentation',
            apiReference: 'API Reference',
            smartContracts: 'Smart Contracts',
            about: 'About',
            privacyPolicy: 'Privacy Policy',
            terms: 'Terms of Service',
            rights: '© 2026 GHOSTLINK. All rights reserved.',
            network: 'Network::Sepolia',
            poweredBy: 'Powered by::RISC Zero',
        },
        contractInspector: {
            tag: 'CONTRACT::INSPECTOR',
            title: 'Contract Inspector',
            subtitle: 'A clean, trustless view of the deployed GhostLinkSBT contract and its ZK verification hook.',
            verifiedBadge: 'Verified on Sepolia',
            openEtherscan: 'Open Etherscan',
            fileTree: 'FILES',
            contractAddress: 'Address',
            copy: 'One-click Copy',
            copySource: 'Copy current file',
            copied: 'Copied',
            downloadAbi: 'Download ABI',
            loading: 'Loading…',
            loadFailed: 'Load failed',
            riscTitle: 'RISC ZERO VERIFICATION',
            riscBody: 'This block hashes the journal (sender + nullifier + credType) into journalHash, then calls verifier.verify(seal, imageId, journalHash). Verification failure reverts; success continues minting.',
        },
        solutions: {
            systemSolutions: 'System Solutions::V3',
            privacyBridge: 'Privacy Bridge',
            interface: 'Interface',
            privacyBridgeInterface: 'Privacy Bridge Interface',
            subtitle: 'Transform fragmented Web2 activity into secure, on-chain zero-knowledge proofs.',
            systemOnline: 'System Online',
            zkProofEngine: 'ZK Proof Engine :: {title}',
            statusSecured: 'Status::Secured by ZK',
            sybilControls: 'Sybil Guard controls',
            twitterX: 'Twitter / X',
            activeCount: '{count} Active',
            tabs: {
                defiTitle: 'Asset-Pass',
                defiDesc: 'Verify your assets to unlock under-collateralized DeFi loans.',
                growthTitle: 'Sybil Guard',
                growthDesc: 'Verify real-world signals to prevent Sybil attacks.',
                identityTitle: 'Identity Bridge',
                identityDesc: 'Link multiple Web2 accounts to form a private on-chain identity.',
            },
            labels: {
                ethMainnet: 'ETH Mainnet',
                solvencyPass: 'Solvency Pass v1',
                appDataSource: 'App Data Source',
                exclusiveAirdrop: 'Exclusive Airdrop',
                proveRideHistory: 'Prove Ride History',
                socialCredentials: 'Social Credentials',
                passport: 'Passport v2',
                bind: 'Bind',
                binding: 'Binding...',
            },
        },
        alipay: {
            assets: 'Alipay Assets',
            uploadPdf: 'Upload PDF Statement',
            dropHere: 'Drop PDF Here',
            clickBrowse: 'or click to browse',
            verify: 'Verify',
            verifying: 'Verifying...',
            mint: 'Mint Credential',
            minting: 'Minting...',
            connectFirst: 'Please connect wallet first',
            selectFileFirst: 'Please select a file first',
            uploadPdfOnly: 'Please upload a PDF file',
            verified: 'VERIFIED',
            minted: 'MINTED',
            verifyStatement: 'Verify Statement',
            mintFailed: 'Minting failed',
            progressTitle: 'Alipay · Proof → Mint',
            stepGenerate: 'Generate ZK Proof',
            stepPrepare: 'Prepare Transaction',
            stepConfirm: 'Confirm in Wallet',
            stepAwait: 'Await Confirmation',
            stepDone: 'Completed',
            descGenerate: 'Prover is starting…',
            descPrepare: 'Transaction is preparing…',
            descConfirm: 'Waiting wallet confirmation…',
            descAwait: 'Waiting for chain confirmation…',
            descDone: 'Done',
            uploadFailed: 'Upload failed',
            proofFailed: 'Failed to generate proof',
            idNumberLabel: 'ID Number',
            idNumberNotAvailable: 'Not available',
        },
        errors: {
            configGithubClientId: 'Configuration error: please set your GitHub Client ID.',
            configTwitterClientId: 'Configuration error: please set TWITTER_CLIENT_ID.',
            walletConnectFailed: 'Failed to connect wallet. Please try again.',
            ethersLoadFailed: 'Failed to load ethers.js. Please refresh the page and try again.',
            metamaskNotDetected: 'MetaMask is not detected. Please install the MetaMask extension.',
            walletConnectionFailedWithMessage: 'Wallet connection failed: {message}',
            connectWalletFirst: 'Please connect your wallet first.',
            missingProof: 'Missing zero-knowledge proof data.',
            transactionSimulationFailed: 'Transaction simulation failed',
            transactionWillFail: 'Transaction will fail: {message}',
            transactionFailed: 'Transaction failed.',
            userRejectedTx: 'User rejected the transaction.',
        },
    },
    zh: {
        common: {
            appName: 'GHOSTLINK',
            language: '语言',
            english: '英文',
            chinese: '中文',
            close: '关闭',
            or: '或',
            verified: '已验证',
            connect: '连接',
            generatingProof: '生成证明中…',
            source: '来源',
            zkCircuit: 'ZK CIRCUIT',
            kilobytes: '千字节',
        },
        theme: {
            toggle: '切换主题',
            switchToLight: '切换到亮色模式',
            switchToDark: '切换到暗色模式',
            lightMode: '亮色模式',
            darkMode: '暗色模式',
        },
        nav: {
            home: '首页',
            solutions: '解决方案',
            explorer: '探索',
            developers: '开发者',
            company: '关于我们',
        },
        wallet: {
            connect: '连接钱包',
            connecting: '正在连接…',
            disconnect: '断开连接',
            disconnected: '钱包已断开',
            notConnected: '尚未连接钱包，请先连接。',
        },
        portfolio: {
            onChainAssets: '链上资产',
            readyToVerify: '已就绪，可验证',
            connectToVerify: '连接钱包后开始验证',
            verify: '开始验证',
            verifying: '验证中…',
            mint: '铸造凭证',
            verificationFailed: '验证失败',
            walletNotConnected: '未连接钱包',
            progressTitle: '钱包 · 证明 → 铸造',
            verified: '已验证',
            minted: '已铸造',
            transactionHistory: '交易记录',
            signing: '签名中…',
            retry: '重试',
            generatingProof: '生成证明中…',
            txCount: '{count} 笔交易',
        },
        modal: {
            processing: '处理中',
            zkGenerating: '正在生成零知识证明…',
            mintSuccess: '铸造成功',
            viewOnEtherscan: '在 Etherscan 查看 →',
            errorPrefix: '错误::',
        },
        progress: {
            stepGenerate: '生成零知识证明',
            stepPrepare: '准备交易',
            stepConfirm: '钱包确认',
            stepAwait: '等待上链',
            stepDone: '完成',
            descGenerate: '证明器启动中…',
            descPrepare: '交易组装中…',
            descConfirm: '等待钱包签名…',
            descAwait: '链上确认中…',
            descDone: '流程完成',
            proofReady: '证明就绪',
            txParamsReady: '交易参数就绪',
            confirmInWallet: '请在钱包中确认',
            waitingWallet: '等待钱包确认…',
            txSubmittedWaiting: '交易已提交，等待链上确认…',
            txSubmitted: '交易已提交…',
            mintedOk: '凭证铸造成功。',
            failedPrefix: '失败：{message}',
            proofToMint: '证明 → 铸造',
            githubProofToMint: 'GitHub · 证明 → 铸造',
            twitterProofToMint: 'X · 证明 → 铸造',
        },
        footer: {
            tagline: '把你的 Web2 轨迹，变成可验证、可携带的链上凭证（零知识，先验隐私）。',
            resources: '资源',
            company: '公司',
            documentation: '文档',
            apiReference: '接口说明',
            smartContracts: '合约',
            about: '简介',
            privacyPolicy: '隐私政策',
            terms: '服务条款',
            rights: '© 2026 GHOSTLINK. 保留所有权利。',
            network: '网络::Sepolia',
            poweredBy: '底层::RISC Zero',
        },
        contractInspector: {
            tag: '合约::审计台',
            title: '合约审计台',
            subtitle: '把关键合约摊开给任何人看 逐行可验 逐行可追',
            verifiedBadge: '已在 Sepolia 验证',
            openEtherscan: '前往 Etherscan',
            fileTree: '文件',
            contractAddress: '地址',
            copy: '一键复制',
            copySource: '复制当前文件',
            copied: '已复制',
            downloadAbi: '下载 ABI',
            loading: '加载中',
            loadFailed: '加载失败',
            riscTitle: 'RISC ZERO 证明校验',
            riscBody: '这段逻辑先把 sender nullifier credType 组装后做 sha256 得到 journalHash 再交给 verifier.verify(seal imageId journalHash) 做校验 校验失败会直接 revert 校验通过才继续铸造',
        },
        solutions: {
            systemSolutions: '系统方案::V3',
            privacyBridge: '隐私桥',
            interface: '界面',
            privacyBridgeInterface: '隐私桥界面',
            subtitle: '把分散的 Web2 行为，汇聚成安全、可验证的链上零知识证明。',
            systemOnline: '系统在线',
            zkProofEngine: '证明引擎 :: {title}',
            statusSecured: '状态::已由零知识加固',
            sybilControls: '女巫防线控制台',
            twitterX: 'X（原 Twitter）',
            activeCount: '{count} 已启用',
            tabs: {
                defiTitle: '资产通行证',
                defiDesc: '验证资产实力，打开更灵活的 DeFi 借贷空间。',
                growthTitle: '女巫防线',
                growthDesc: '用真实世界信号抵抗女巫攻击，增长更干净。',
                identityTitle: '身份桥',
                identityDesc: '把多个 Web2 账号组合成更强韧、更私密的链上身份。',
            },
            labels: {
                ethMainnet: '以太坊主网',
                solvencyPass: '偿付能力凭证 v1',
                appDataSource: '数据来源',
                exclusiveAirdrop: '专属空投',
                proveRideHistory: '验证行程记录',
                socialCredentials: '社交凭证',
                passport: '通行证 v2',
                bind: '绑定',
                binding: '绑定中…',
            },
        },
        alipay: {
            assets: '支付宝资产',
            uploadPdf: '上传账单（PDF）',
            dropHere: '把 PDF 拖到这里',
            clickBrowse: '或点击选择文件',
            verify: '开始验证',
            verifying: '验证中…',
            mint: '铸造凭证',
            minting: '铸造中…',
            connectFirst: '请先连接钱包',
            selectFileFirst: '请先选择文件',
            uploadPdfOnly: '只支持 PDF 文件',
            verified: '已验证',
            minted: '已铸造',
            verifyStatement: '验证账单',
            mintFailed: '铸造失败',
            progressTitle: '支付宝 · 证明 → 铸造',
            stepGenerate: '生成零知识证明',
            stepPrepare: '准备交易',
            stepConfirm: '钱包确认',
            stepAwait: '等待上链',
            stepDone: '完成',
            descGenerate: '证明器启动中…',
            descPrepare: '交易组装中…',
            descConfirm: '等待钱包签名…',
            descAwait: '链上确认中…',
            descDone: '流程完成',
            uploadFailed: '上传失败',
            proofFailed: '生成证明失败',
            idNumberLabel: '身份证号',
            idNumberNotAvailable: '暂未获取',
        },
        errors: {
            configGithubClientId: '配置缺失：请先设置 GitHub Client ID。',
            configTwitterClientId: '配置缺失：请先设置 TWITTER_CLIENT_ID。',
            walletConnectFailed: '钱包连接失败，请重试。',
            ethersLoadFailed: '依赖加载失败，请刷新页面后重试。',
            metamaskNotDetected: '未检测到 MetaMask，请先安装钱包插件。',
            walletConnectionFailedWithMessage: '钱包连接失败：{message}',
            connectWalletFirst: '请先连接钱包。',
            missingProof: '缺少零知识证明数据。',
            transactionSimulationFailed: '交易模拟失败',
            transactionWillFail: '交易将失败：{message}',
            transactionFailed: '交易失败。',
            userRejectedTx: '你已取消本次交易。',
        },
    },
};

export const getLocale = () => {
    try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored === LOCALES.ZH || stored === LOCALES.EN) return stored;
    } catch {
        // ignore
    }
    return DEFAULT_LOCALE;
};

export const setLocale = (locale) => {
    try {
        localStorage.setItem(STORAGE_KEY, locale);
    } catch {
        // ignore
    }
};

const format = (template, params) => {
    if (!params) return template;
    return template.replace(/\{(\w+)\}/g, (_, key) => (params[key] ?? `{${key}}`));
};

export const t = (key, params, localeOverride) => {
    const locale = localeOverride || getLocale();
    const segments = key.split('.');

    const read = (obj) => segments.reduce((acc, k) => (acc && acc[k] != null ? acc[k] : undefined), obj);

    const value = read(STRINGS[locale]) ?? read(STRINGS[DEFAULT_LOCALE]) ?? key;
    if (typeof value !== 'string') return key;
    return format(value, params);
};
